<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Petanque Match Results</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f0f4f8;
      padding: 2rem;
    }
    h2 {
      text-align: center;
      color: #0066cc;
    }
    .group-section {
      margin-bottom: 3rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      background-color: #e0f0ff;
    }
    .matrix-cell.red {
      background-color: red;
    }
    .match-matrix {
      overflow-x: auto;
      margin-top: 1rem;
    }
    .venue-time {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.1rem;
    }
    button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #3498db;
      color: white;
    }
    button:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>
  <h2>Petanque Match Results</h2>
  <div id="groups-container"></div>
<div class="group-container" id="groupTables"></div>

<div class="match-section">
  <h2 style="text-align:center;">Match Schedule & Results</h2>
  <table id="matchTable">
    <thead>
      <tr><th>Match</th><th>Venue</th><th>Time</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="venue-time" id="latestVenueTime"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDpS-kqwQDgdqiVK2kwXGB9a3B7WeJI_Iw",
    authDomain: "unimap-petanque.firebaseapp.com",
    projectId: "unimap-petanque",
    storageBucket: "unimap-petanque.appspot.com",
    messagingSenderId: "578920021890",
    appId: "1:578920021890:web:987ed2de28e7b0353c999b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const groups = ["A", "B", "C", "D", "E", "F"];
  const groupTables = document.getElementById("groupTables");

  async function loadTeams() {
    const snapshot = await getDocs(collection(db, "teams"));
    const groupMap = {};

    snapshot.forEach(doc => {
      const data = doc.data();
      const group = data.group;
      if (!groupMap[group]) groupMap[group] = [];
      groupMap[group].push({
        name: data.teamName,
        main: data.main || 0,
        win: data.win || 0,
        lose: data.lose || 0,
        pointPlus: data.pointPlus || 0,
        pointMinus: data.pointMinus || 0
      });
    });

    groups.forEach(g => {
      const teams = groupMap[g] || [];
      let html = `
        <div class="group">
          <h3>Group ${g}</h3>
          <table>
            <thead>
              <tr>
                <th>Team</th>
                <th>Play</th>
                <th>Win</th>
                <th>Lose</th>
                <th>Point</th>
                <th>+Pt</th>
                <th>-Pt</th>
              </tr>
            </thead>
            <tbody>
      `;

      teams.forEach(t => {
        const point = t.win * 3; // 3 points for win
        html += `
          <tr>
            <td>${t.name}</td>
            <td>${t.main}</td>
            <td>${t.win}</td>
            <td>${t.lose}</td>
            <td>${point}</td>
            <td>${t.pointPlus}</td>
            <td>${t.pointMinus}</td>
          </tr>
        `;
      });

      html += "</tbody></table></div>";
      groupTables.innerHTML += html;
    });
  }

  async function loadMatches() {
    const matchSnapshot = await getDocs(query(collection(db, "matches"), orderBy("timestamp", "desc")));
    const matchTable = document.querySelector("#matchTable tbody");
    const venueTimeDiv = document.getElementById("latestVenueTime");
    let latestVenue = "", latestTime = "";

    matchSnapshot.forEach((doc, index) => {
      const data = doc.data();
      if (index === 0) {
        latestVenue = data.venue;
        latestTime = data.time;
      }
      matchTable.innerHTML += `
        <tr>
          <td>${data.match}</td>
          <td>${data.venue}</td>
          <td>${data.time}</td>
        </tr>
      `;
    });

    if (latestVenue && latestTime) {
      venueTimeDiv.textContent = `Latest Match - Venue: ${latestVenue}, Time: ${latestTime}`;
    }
  }

  loadTeams();
  loadMatches();
</script>
    <button onclick="location.href='index.html'">Back to Main</button>
</body>
</html>
